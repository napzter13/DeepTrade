# DeepTrade

DeepTrade is a Python-based prototype for quantitative cryptocurrency trading and research. It combines historical backtesting, multi-timeframe LSTM modeling, GPT-based sentiment analysis, and optional offline Reinforcement Learning (DQN).

## Multi-Timeframe LSTM-Transformer Model Architecture

<center><img src="models/advanced_lstm_model_architecture.png" alt="Multi-Timeframe LSTM-Transformer Model Architecture" width="300"></center>

Advanced multi-input deep learning architecture combining residual LSTM layers, Transformer-style self-attention mechanisms, and dense feed-forward networks. The model processes multiple time-series inputs (e.g., 5m, 15m, 1h, Google Trends and Santiment data) alongside sentiment analysis, technical indicators, and market signals. Each time-series branch undergoes LSTM-based encoding, followed by Transformer layers for capturing sequential dependencies. The encoded outputs are then merged with contextual inputs (Santiment, TA indicators, and signal data), forming a unified latent representation, which is further refined through fully connected layers to produce a signal.

## Deep Q-Network (DQN) reinforcement learning

After the neural network model generates a signal, it is processed by the **Deep Q-Network (DQN) reinforcement learning agent** defined in `rl.py`. The **DQNAgent** is responsible for translating the model's encoded market state into a discrete trading action: **LONG, SHORT, or HOLD**. 

The agent achieves this by:
1. Maintaining a **replay buffer** that stores past state-action-reward transitions, enabling experience replay.
2. Using a **feed-forward neural network** to approximate Q-values for each possible action.
3. Implementing an **epsilon-greedy policy** for action selection, balancing exploration (random actions) and exploitation (choosing the best predicted action).
4. Periodically **updating a target network** to stabilize learning.
5. **Training via mini-batch gradient descent**, where it learns to approximate the best action-value function using stored experiences.

As the agent receives the processed signal, it evaluates the **expected future rewards** associated with each possible action, refines its decision-making process through reinforcement learning, and ultimately selects the best trading action to execute in the live market.

## Project Status

- **Alpha:** Core code is functional but experimental.
- **No guaranteed performance:** This is a research/learning tool.
- **Many aspects** (model architecture, signals, RL logic) are still being tested.
- **Contributions, issues, and suggestions are welcome!**

> **Disclaimer:** This project is in active development and might contain bugs. There is no guarantee of profitability or correctness. Use for learning and experimentation.

## Overview

### Major Components

1. **`backtester.py`**
   - Simulates historical trading from a specified start date to end date.
   - Generates scenario-based CSV logs (e.g., `backtest_result_local_gpt_1.csv`) to observe how different signals would have performed.
   - Builds a supervised learning dataset in `training_data.csv` for an advanced multi-input LSTM model (after a +3h future price offset).

2. **`fitter.py`**
   - Trains a multi-input LSTM model using the `training_data.csv` generated by the backtester.
   - Saves the trained model to `lstm_model.h5`.

3. **`trader.py`**
   - Executes live trading using the trained LSTM model.
   - Incorporates real-time data and GPT-based sentiment analysis to make trading decisions.

4. **`merge_training_data.py`**
   - Merges multiple `training_data.csv` files from different backtests into a single dataset for comprehensive training.

5. **`fix_tf_gpu.py`**
   - Utility script to address TensorFlow GPU issues on Windows systems.

## Additional Important Directories and Files

- **`.env.copy`** - Example environment configuration file. Rename this to `.env` and fill in your API keys and other required environment variables.

- **`botlib/`** - Core library containing helper functions and modules for trading logic.
  - **`tradebot.py`** - Defines the `TradingBot` class, handling data fetching, aggregation, RL state-building, and position management.
  - **`environment.py`** - Manages shared environment variables and utilities, including logging.
  - **`datafetchers.py`** - Contains functions to retrieve data from Binance, news APIs, Google Trends, and Santiment.
  - **`input_preprocessing.py`** - Includes the `ModelScaler` class and helpers to scale inputs for the multi-timeframe LSTM model.
  - **`indicators.py`** - Implements technical indicators like RSI, MACD, and Bollinger Bands.
  - **`models.py`** - Loads local HuggingFace language models or OpenAI for sentiment analysis and constructs the LSTM model.
  - **`rl.py`** - Implements a simple DQNAgent for RL-based action selection and manages offline training memory.
  - **`nn_model.py`** - Defines neural network architectures and utilities for training and inference.

- **`models/`** - Stores trained machine learning models.
  - **`advanced_lstm_model.keras`** - The saved multi-timeframe LSTM model, generated at runtime.

- **`output/`** - Stores all CSV outputs, including backtest logs, `training_data.csv`, and RL transitions.

- **`input_cache/`** - Cache for downloaded data (e.g., klines, news) to speed up repeated runs.

- **`debug/`** - Contains various logs or debugging information, such as GPT call logs and aggregator prompts.

- **`training_data/`** - Stores raw and processed datasets used for training the models.

## Setup and Installation

### Prerequisites

- Python 3.6
- Conda package manager
- NVIDIA GPU with CUDA support (for GPU acceleration)

### Installation Steps

1. **Clone the Repository:**

   ```bash
   git clone https://github.com/napzter13/DeepTrade.git
   cd DeepTrade
   ```

2. **Set Up the Conda Environment:**

   Update Conda and create a new environment:

   ```bash
   conda update -n base -c defaults conda
   conda update -n base --all
   conda create --name deeptrade_env python=3.6
   conda activate deeptrade_env
   ```

3. **Install Dependencies:**

   Install required packages:

   ```bash
   pip install -r requirements.txt
   ```

4. **Configure API Keys:**

   - Rename `.env.copy` to `.env`.
   - Populate the `.env` file with your API keys and other necessary configurations.

## Usage

1. **Backtesting:**

   Run the backtester to simulate historical trading:

   ```bash
   python backtester.py
   ```

   - Iterates historically hour by hour.
   - Writes scenario CSVs to output/ and accumulates training data in training_data/training_data.csv.

2. **Training the Model:**

   After generating `training_data.csv` through backtesting, train the LSTM model:

   ```bash
   python fitter.py
   ```

   - Reads from training_data.csv and trains a multi-input LSTM.
   - You can also train an offline DQN if you have training_data/rl_transitions.csv.

3. **Live Trading:**

   Once the model is trained and saved as `lstm_model.h5`, start live trading:

   ```bash
   python trader.py
   ```

   - Instantiates TradingBot, does an immediate run, then schedules hourly runs.
   - If PAPER_TRADING is set (in environment.py or .env), it simulates trades locally.
   - Otherwise, it attempts real trades on your configured exchange.

## Contributing

1. Fork the repo & create a feature branch.
2. Make your changes, add tests if possible.
3. Submit a Pull Request and describe your changes in detail.

## License

This project does not yet have a formal license.
Use at your own risk, for non-commercial or internal research purposes.

For questions, open an Issue on GitHub.

## Acknowledgments

- [Binance Python API](https://github.com/binance/binance-spot-api-docs)  
- [OpenAI / GPT APIs](https://platform.openai.com/docs/introduction)  
- [Transformers (HuggingFace)](https://github.com/huggingface/transformers)  
- [TensorFlow / Keras](https://github.com/tensorflow/tensorflow)  
- and the broader open-source ecosystem.

